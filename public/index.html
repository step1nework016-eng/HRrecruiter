<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ‹›å‹Ÿé¡§å• AI æ™ºèƒ½é«” </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <style>
    :root {
      --bg: #ffffff;
      --card: #ffffff;
      --accent: #0ea5e9;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-soft: #6b7280;
      --radius-lg: 16px;
      --radius-xl: 22px;
      --shadow-soft: 0 8px 24px rgba(15, 23, 42, 0.06);
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans TC", sans-serif;
    }
    /* ç¢ºä¿æ‰€æœ‰æ–‡å­—éƒ½å¯ä»¥é¸æ“‡å’Œè¤‡è£½ */
    body, html {
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    body {
      background: var(--bg);
      color: var(--text-main);
      margin: 0;
      padding: 32px 16px;
      display: flex;
      justify-content: center;
      overflow-x: hidden;
      width: 100%;
      position: relative;
    }
    html {
      overflow-x: hidden;
      width: 100%;
      position: relative;
    }
    .app-shell {
      width: 100%;
      max-width: 1200px;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 24px;
    }
    @media (max-width: 900px) {
      .app-shell {
        grid-template-columns: 1fr;
        padding-bottom: 16px;
        width: 100%;
        overflow-x: hidden;
      }
      body {
        padding: 16px;
        overflow-x: hidden;
        position: relative;
        touch-action: pan-y;
      }
      html {
        overflow-x: hidden;
        touch-action: pan-y;
      }
    }
    .card {
      background: var(--card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      padding: 20px;
    }
    /* å´é‚Šæ¬„ */
    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
    }
    .logo-circle {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: linear-gradient(135deg, #0ea5e9, #38bdf8);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 16px;
    }
    .title-main {
      font-weight: 700;
      font-size: 16px;
    }
    .title-sub {
      font-size: 12px;
      color: var(--text-soft);
    }
    .step-list {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .step-item {
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid transparent;
      color: var(--text-soft);
      cursor: pointer;
      transition: 0.18s;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    .step-item:hover {
      background: #f9fafb;
    }
    .step-item.active {
      border-color: var(--accent);
      background: #f0f9ff;
      color: var(--accent);
    }
    .step-badge {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }
    .step-item.active .step-badge {
      border-color: var(--accent);
      color: var(--accent);
    }
    .sidebar-footer {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px dashed #e5e7eb;
      font-size: 11px;
      color: var(--text-soft);
      line-height: 1.5;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 4px 8px;
      margin-top: 6px;
      font-size: 10px;
      background: #f9fafb;
    }

    /* ä¸»ç•«é¢å…±ç”¨ï¼ˆæ¡Œæ©Ÿ+æ‰‹æ©Ÿï¼‰ */
    .main-title-wrap {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .main-title {
      font-size: 18px;
      font-weight: 700;
    }
    .main-subtitle {
      font-size: 12px;
      color: var(--text-soft);
    }
    .badge-ai {
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 5px 10px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #f9fafb;
      white-space: nowrap;
    }
    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.18);
    }
    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    /* å·¥å…·å€ï¼šæ¡Œæ©Ÿç‰ˆç‚ºå…§åµŒï¼Œæ‰‹æ©Ÿç‰ˆç‚ºå…¨è¢å¹•å½ˆçª— */
    .tool-modal {
      margin-bottom: 12px;
      display: none;
    }
    .tool-modal.open {
      display: block;
    }
    .home-welcome {
      display: block;
    }
    .tool-close-btn {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 4px 10px;
      font-size: 12px;
      background: #ffffff;
      cursor: pointer;
      align-items: center;
      gap: 4px;
    }

    .panel {
      margin-top: 8px;
      display: grid;
      grid-template-columns: 1.15fr 1.35fr;
      gap: 20px;
    }
    @media (max-width: 900px) {
      .panel {
        grid-template-columns: 1fr;
      }
      .tool-modal {
        position: fixed;
        inset: 0;
        padding: 16px;
        background: #f3f4f6;
        z-index: 50;
        overflow-y: auto;
        display: none;
      }
      .tool-modal.open {
        display: block;
      }
      .badge-ai {
        display: none;
      }
      .tool-close-btn {
        display: inline-flex;
        border-radius: 999px;
        border: 1px solid #e5e7eb;
        padding: 4px 10px;
        font-size: 12px;
        background: #ffffff;
        cursor: pointer;
        align-items: center;
        gap: 4px;
      }
      .tool-inner-card {
        background: #ffffff;
        border-radius: 18px;
        border: 1px solid #e5e7eb;
        box-shadow: var(--shadow-soft);
        padding: 16px;
      }
    }
    @media (min-width: 901px) {
      .tool-inner-card {
        padding: 0;
      }
    }

    .panel h4 {
      font-size: 13px;
      margin-bottom: 6px;
    }
    .hint {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 6px;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    textarea {
      width: 100%;
      min-height: 190px;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      font-size: 13px;
      resize: vertical;
      outline: none;
    }
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(14, 165, 233, 0.4);
    }
    pre {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: var(--radius-lg);
      padding: 12px;
      font-size: 12px;
      line-height: 1.5;
      overflow: auto;
      max-height: 320px;
      white-space: pre-wrap;
      word-break: break-word;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
      cursor: text;
    }
    .toolbar {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      font-size: 11px;
      color: var(--text-soft);
    }
    .btn-primary {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 8px 18px rgba(14, 165, 233, 0.35);
    }
    .btn-primary:hover {
      background: #0284c7;
    }
    .btn-primary[disabled] {
      opacity: 0.7;
      cursor: default;
      box-shadow: none;
    }
    .status {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 6px;
    }
    .status .dot {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      margin-right: 4px;
      background: #9ca3af;
    }
    .status.loading .dot {
      background: #0ea5e9;
      box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.18);
    }
    .status.error .dot {
      background: #ef4444;
      box-shadow: 0 0 0 4px rgba(248, 113, 113, 0.18);
    }
    .chip-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 10px;
    }
    .chip {
      padding: 4px 8px;
      border-radius: 999px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      color: var(--text-soft);
    }

    /* Chat å€å¡Šï¼šé—œæ‰å·¥å…·å¾Œæ‰‹æ©Ÿåªæœƒçœ‹åˆ°é€™å€‹ */
    .chat-card {
      margin-top: 10px;
    }
    .chat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .chat-title {
      font-size: 14px;
      font-weight: 600;
    }
    .chat-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }
    .chat-window {
      border-radius: var(--radius-lg);
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 10px;
      max-height: 260px;
      overflow-y: auto;
      font-size: 13px;
    }
    .chat-empty {
      font-size: 12px;
      color: var(--text-soft);
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    .chat-msg {
      margin-bottom: 8px;
      display: flex;
      gap: 8px;
    }
    .chat-msg.me {
      justify-content: flex-end;
    }
    .chat-bubble {
      max-width: 80%;
      padding: 8px 10px;
      border-radius: 14px;
      line-height: 1.5;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    .chat-msg.me .chat-bubble {
      background: #0ea5e9;
      color: #fff;
      border-bottom-right-radius: 2px;
    }
    .chat-msg.ai .chat-bubble {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-bottom-left-radius: 2px;
    }
    .chat-role {
      font-size: 10px;
      color: var(--text-soft);
      margin-bottom: 2px;
    }
    .chat-input-row {
      margin-top: 8px;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .chat-input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      font-size: 13px;
      outline: none;
      background: #ffffff;
    }
    .chat-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(14, 165, 233, 0.3);
    }
    .btn-chat {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 13px;
      background: #0ea5e9;
      color: #fff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .btn-chat[disabled] {
      opacity: 0.6;
      cursor: default;
    }
    .chat-status {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-soft);
    }
    .thinking {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .thinking-dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--accent);
      animation: thinking 1.4s infinite;
    }
    .thinking-dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    .thinking-dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    @keyframes thinking {
      0%, 60%, 100% {
        opacity: 0.3;
        transform: scale(0.8);
      }
      30% {
        opacity: 1;
        transform: scale(1);
      }
    }
    .chat-content {
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
      cursor: text;
    }
    .chat-content strong {
      font-weight: 600;
      color: var(--text-main);
    }
    /* å…¨å±å°è©±é é¢ */
    .fullscreen-chat {
      display: none;
      position: fixed;
      inset: 0;
      background: var(--bg);
      z-index: 100;
      flex-direction: column;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      transform: none;
      zoom: 1;
    }
    .fullscreen-chat.active {
      display: flex;
    }
    .fullscreen-chat-header {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--card);
    }
    .fullscreen-chat-body {
      flex: 1;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 0;
      overflow: hidden;
    }
      .fullscreen-chat-sidebar {
        border-right: 1px solid var(--border);
        padding: 20px;
        background: var(--card);
        overflow-y: auto;
        position: relative;
      }
      .fullscreen-chat-sidebar .sidebar-header {
        position: relative;
        padding-left: 0;
      }
      .sidebar-close-btn {
        position: absolute;
        top: 0;
        left: 0;
        background: transparent;
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 6px 10px;
        font-size: 16px;
        cursor: pointer;
        color: var(--text-soft);
        z-index: 10;
        min-width: 32px;
        height: 32px;
        display: none;
        align-items: center;
        justify-content: center;
      }
      .sidebar-close-btn:hover {
        background: #f9fafb;
        color: var(--text-main);
      }
      @media (max-width: 900px) {
        .fullscreen-chat-sidebar .sidebar-header {
          padding-left: 40px;
        }
        .sidebar-close-btn {
          display: flex !important;
        }
      }
    .fullscreen-chat-main {
      display: flex;
      flex-direction: column;
      background: var(--bg);
      overflow-x: hidden;
      width: 100%;
    }
    .fullscreen-chat-window {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
      overflow-x: hidden;
      background: var(--bg);
      width: 100%;
    }
    .fullscreen-chat-input-area {
      padding: 20px 24px;
      border-top: 1px solid var(--border);
      background: var(--card);
    }
    .btn-enter-chat {
      margin-top: 12px;
      width: 100%;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .btn-enter-chat:hover {
      background: #0284c7;
    }
    .btn-close-fullscreen {
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      color: var(--text-soft);
    }
    .btn-close-fullscreen:hover {
      background: #f9fafb;
      color: var(--text-main);
    }
    .mobile-nav-toggle {
      display: none;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 16px;
      cursor: pointer;
      min-width: 40px;
      height: 40px;
      align-items: center;
      justify-content: center;
    }
    .mobile-nav-toggle:hover {
      background: var(--bg);
    }
    @media (max-width: 900px) {
      .fullscreen-chat {
        width: 100vw;
        height: 100vh;
        overflow-x: hidden;
        touch-action: pan-y;
      }
      .fullscreen-chat-body {
        grid-template-columns: 1fr;
        position: relative;
        overflow-x: hidden;
        width: 100%;
      }
      .fullscreen-chat-sidebar {
        position: fixed;
        left: -280px;
        top: 0;
        bottom: 0;
        width: 280px;
        z-index: 101;
        transition: left 0.3s;
        box-shadow: 2px 0 8px rgba(0,0,0,0.1);
      }
      .fullscreen-chat-sidebar.open {
        left: 0;
      }
      .fullscreen-chat-sidebar.open .sidebar-close-btn {
        display: flex !important;
      }
      .mobile-nav-toggle {
        display: flex;
      }
      .fullscreen-chat-header {
        padding: 12px 16px;
      }
      .fullscreen-chat-window {
        padding: 16px;
      }
      .fullscreen-chat-input-area {
        padding: 12px 16px;
      }
      .sidebar-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.3);
        z-index: 100;
      }
      .sidebar-overlay.open {
        display: block;
      }
    }
    /* æ­¡è¿å‹•ç•«é é¢ */
    .welcome-screen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 50%, #2563eb 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 1;
      transition: opacity 0.8s ease-out;
    }
    .welcome-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .welcome-logo {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 32px;
      animation: logoScale 1.2s ease-out;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    @keyframes logoScale {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
    .welcome-text {
      font-size: 32px;
      font-weight: 700;
      color: #ffffff;
      text-align: center;
      margin-bottom: 16px;
      animation: textFadeIn 1s ease-out 0.5s both;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    .welcome-subtitle {
      font-size: 18px;
      color: rgba(255, 255, 255, 0.9);
      text-align: center;
      animation: textFadeIn 1s ease-out 1s both;
    }
    @keyframes textFadeIn {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .welcome-dots {
      display: flex;
      gap: 8px;
      margin-top: 40px;
      animation: textFadeIn 1s ease-out 1.5s both;
    }
    .welcome-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.6);
      animation: dotPulse 1.4s ease-in-out infinite;
    }
    .welcome-dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    .welcome-dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    @keyframes dotPulse {
      0%, 100% {
        opacity: 0.6;
        transform: scale(1);
      }
      50% {
        opacity: 1;
        transform: scale(1.2);
      }
    }
  </style>
</head>
<body>
  <!-- æ­¡è¿å‹•ç•«é é¢ -->
  <div class="welcome-screen" id="welcome-screen">
    <div class="welcome-logo">HR</div>
    <div class="welcome-text">
      æ­¡è¿ä½¿ç”¨<br />æ‹›å‹Ÿé¡§å• AI æ™ºèƒ½é«”
    </div>
    <div class="welcome-subtitle">AI-Powered Recruitment Consultant</div>
    <div class="welcome-dots">
      <div class="welcome-dot"></div>
      <div class="welcome-dot"></div>
      <div class="welcome-dot"></div>
    </div>
  </div>

  <div class="app-shell" id="app-shell" style="opacity: 0; transition: opacity 0.5s ease-in;">
    <!-- å´é‚Šæ¬„ -->
    <aside class="card">
      <div class="sidebar-header">
        <div class="logo-circle">HR</div>
        <div>
          <div class="title-main">æ‹›å‹Ÿé¡§å• AI æ™ºèƒ½é«”</div>
          <div class="title-sub">Job Intake â†’ Sourcing â†’ Screening â†’ Interview</div>
        </div>
      </div>

      <div class="step-list">
        <div class="step-item" data-step="1">
          <div class="step-badge">1</div>
          <div>è·ç¼ºéœ€æ±‚ï¼ˆJob Intakeï¼‰</div>
        </div>
        <div class="step-item" data-step="2">
          <div class="step-badge">2</div>
          <div>äººæ‰æœå°‹ï¼ˆSourcingï¼‰</div>
        </div>
        <div class="step-item" data-step="3">
          <div class="step-badge">3</div>
          <div>åˆæ­¥ç¯©é¸ï¼ˆScreeningï¼‰</div>
        </div>
        <div class="step-item" data-step="4">
          <div class="step-badge">4</div>
          <div>é¢è©¦éšæ®µï¼ˆInterviewï¼‰</div>
        </div>
      </div>

      <div class="sidebar-footer">
        <button class="btn-enter-chat" id="sidebar-enter-chat-btn" style="width: 100%; margin-bottom: 8px;">
          ğŸ’¬ é€²å…¥ AI å°è©±
        </button>
        <div style="font-size: 11px; color: var(--text-soft); line-height: 1.5;">
          æ‰‹æ©Ÿç‰ˆï¼šé»ä¸Šé¢çš„åŠŸèƒ½ï¼Œ<br />
          æœƒæ‰“é–‹å…¨è¢å¹•ç”Ÿæˆé ï¼ŒæŒ‰ã€Œâœ•ã€å¾Œé—œé–‰ã€‚
        </div>
      </div>
    </aside>

    <!-- å³å´ä¸»ç•«é¢ï¼šå·¥å…·ï¼ˆæ¡Œæ©Ÿï¼‰ï¼‹èŠå¤© -->
    <main class="card">
      <!-- ä¸»é æ­¡è¿è¨Šæ¯ -->
      <div id="home-welcome" class="home-welcome">
        <div style="text-align: center; padding: 60px 20px; color: var(--text-soft);">
          <div style="font-size: 48px; margin-bottom: 16px;">ğŸ‘‹</div>
          <div style="font-size: 20px; font-weight: 600; color: var(--text-main); margin-bottom: 8px;">
            æ­¡è¿ä½¿ç”¨æ‹›å‹Ÿé¡§å• AI æ™ºèƒ½é«”
          </div>
          <div style="font-size: 14px; line-height: 1.8; max-width: 600px; margin: 0 auto; text-align: left;">
            <div style="margin-bottom: 20px;">
              <strong style="color: var(--text-main);">ä½¿ç”¨æµç¨‹ï¼š</strong><br />
              <strong>è·ç¼ºéœ€æ±‚</strong> â†’ <strong>äººæ‰æœå°‹</strong> â†’ <strong>åˆæ­¥ç¯©é¸</strong> â†’ <strong>é¢è©¦éšæ®µ</strong>
            </div>
            <div style="background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 12px 16px; border-radius: 8px; margin-bottom: 16px;">
              <strong style="color: #0ea5e9;">ğŸ’¡ è¨˜æ†¶åŠŸèƒ½ä½¿ç”¨èªªæ˜ï¼š</strong><br />
              <div style="margin-top: 8px; font-size: 13px;">
                1. å…ˆä½¿ç”¨å››å¤§åŠŸèƒ½ç”Ÿæˆçµæœï¼ˆç³»çµ±æœƒè‡ªå‹•å„²å­˜ï¼‰<br />
                2. ç„¶å¾Œé€²å…¥ã€ŒAI å°è©±ã€ï¼ŒAI æœƒè‡ªå‹•åƒè€ƒæ‚¨ä¹‹å‰ç”Ÿæˆçš„çµæœ<br />
                3. é€™æ¨£ AI å°±èƒ½æ ¹æ“šæ‚¨çš„å…·é«”æƒ…æ³æä¾›æ›´ç²¾æº–çš„å»ºè­°
              </div>
            </div>
            <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px 16px; border-radius: 8px; font-size: 13px;">
              <strong style="color: #d97706;">âš ï¸ é‡è¦æé†’ï¼š</strong><br />
              <div style="margin-top: 8px;">
                è³‡æ–™ä½¿ç”¨æœ¬åœ°å„²å­˜ï¼ˆlocalStorageï¼‰ï¼Œ<strong>é—œé–‰è¦–çª—æˆ–é‡æ–°æ•´ç†å¾Œè³‡æ–™æœƒæ¶ˆå¤±</strong>ã€‚<br />
                ç›®å‰æš«æ™‚ä¸ä½¿ç”¨ç™»å…¥æ©Ÿåˆ¶ï¼Œå¦‚éœ€é•·æœŸä¿å­˜ï¼Œè«‹è‡ªè¡Œå‚™ä»½çµæœã€‚
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- å·¥å…·å€ï¼šæ¡Œæ©Ÿ=å…§åµŒï¼Œæ‰‹æ©Ÿ=å½ˆçª— -->
      <section id="tool-modal" class="tool-modal">
        <div class="tool-inner-card">
          <div class="main-header">
            <div class="main-title-wrap">
              <div class="main-title" id="main-title">â‘  è·ç¼ºéœ€æ±‚ï¼ˆJob Intakeï¼‰</div>
              <div class="main-subtitle" id="main-subtitle">
                HR è²¼ä¸Šè·ç¼ºèªªæ˜ï¼ˆJDï¼‰ â†’ AI è‡ªå‹•ç”Ÿæˆäººæ‰ç•«åƒèˆ‡çµæ§‹åŒ–æ¬„ä½
              </div>
            </div>
            <div style="display:flex;align-items:center;gap:8px;">
              <div class="badge-ai">
                <div class="badge-dot"></div>
                AI å·²å°±ç·’
              </div>
              <button class="tool-close-btn" id="tool-close-btn">âœ•</button>
            </div>
          </div>

          <div class="panel">
            <!-- å·¦ï¼šè¼¸å…¥ -->
            <div>
              <h4>è¼¸å…¥ï¼ˆHR è²¼ä¸Šå…§å®¹ï¼‰</h4>
              <p class="hint" id="input-hint">
                ç›®å‰æ­¥é©Ÿï¼šè·ç¼ºéœ€æ±‚ï¼ˆJob Intakeï¼‰ã€‚è«‹è²¼ä¸Šå®Œæ•´ JDã€‚
              </p>
              <textarea id="input-text" spellcheck="false">è·ç¼ºï¼šçŸ­å½±éŸ³å‰ªè¼¯å¸«

æˆ‘å€‘æ˜¯ä¸€é–“å°ˆé–€åš AIã€çŸ­å½±éŸ³æ•™å­¸çš„å…¬å¸ï¼Œæ­£åœ¨æ‰¾ä¸€ä½å…¨è·çŸ­å½±éŸ³å‰ªè¼¯å¸«ï¼Œè² è²¬ TikTokã€Reelsã€YouTube Shorts çš„å‰ªè¼¯ã€‚
éœ€è¦ç†Ÿæ‚‰å‰ªæ˜ æˆ– Premiereï¼Œæœƒåšå­—å¹•ã€éŸ³æ¨‚ç¯€å¥ã€è½‰å ´ï¼Œæ‡‚ä¸€é»ç¤¾ç¾¤æ„Ÿçš„ç¯€å¥ï¼ŒçŸ¥é“ä»€éº¼ç•«é¢å®¹æ˜“å¸å¼•è§€çœ¾æ»‘åœã€‚
éœ€å…·å‚™ 1â€“3 å¹´å‰ªè¼¯ç¶“é©—ï¼Œæœ‰ä½œå“é›†ï¼Œèƒ½é…åˆ remote åœ˜éšŠæºé€šã€‚
åŠ åˆ†ï¼šæœ‰æ‹æ”ç¶“é©—ã€æ‡‚è…³æœ¬ç¯€å¥ã€æœƒåŸºæœ¬çš„ç¸®åœ–è¨­è¨ˆã€‚</textarea>

              <div class="toolbar">
                <div style="display:flex;gap:6px;flex-wrap:wrap;">
                  <button class="btn-primary" id="run-btn">
                    âš¡ é–‹å§‹ AI åˆ†æ
                  </button>
                  <button class="btn-primary" id="retry-btn" disabled
                    style="background:#e5e7eb;color:#374151;box-shadow:none;">
                    ğŸ” å†æ›ä¸€å€‹
                  </button>
                  <button class="btn-primary" id="copy-btn" disabled
                    style="background:#22c55e;box-shadow:none;">
                    ğŸ“‹ è¤‡è£½çµæœ
                  </button>
                </div>
              </div>
              <div class="status" id="status">
                <span class="dot"></span> ç­‰å¾…é€å‡ºâ€¦
              </div>
            </div>

            <!-- å³ï¼šè¼¸å‡º -->
            <div>
              <h4>AI å›å‚³çµæœ</h4>
              <p class="hint">
                AI åˆ†æçµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡
              </p>
              <pre id="output-pre">é»ã€Œé–‹å§‹ AI åˆ†æã€å¾Œæœƒé¡¯ç¤ºçµæœ</pre>
            </div>
          </div>

        </div>
      </section>

    </main>
  </div>

  <!-- å…¨å± AI å°è©±é é¢ -->
  <div class="sidebar-overlay" id="sidebar-overlay"></div>
  <div class="fullscreen-chat" id="fullscreen-chat">
    <div class="fullscreen-chat-header">
      <button class="mobile-nav-toggle" id="mobile-nav-toggle">â˜°</button>
      <div style="flex: 1; margin-left: 12px;">
        <div style="font-weight: 700; font-size: 18px;">ğŸ’¬ AI å°è©±ï¼ˆHR é¡§å•æ¨¡å¼ï¼‰</div>
        <div style="font-size: 12px; color: var(--text-soft); margin-top: 4px;">
          å¯ä»¥å•æ‹›å‹Ÿç­–ç•¥ã€JD èª¿æ•´å»ºè­°ã€é¢è©¦å•é¡Œè¨­è¨ˆç­‰
        </div>
      </div>
      <button class="btn-close-fullscreen" id="close-fullscreen-chat-btn">
        âœ•
      </button>
    </div>
    
    <div class="fullscreen-chat-body">
      <!-- å·¦å´å°èˆªåˆ— -->
      <div class="fullscreen-chat-sidebar" id="fullscreen-chat-sidebar">
        <div class="sidebar-header">
          <button class="sidebar-close-btn" id="sidebar-close-btn" style="display: none;">âœ•</button>
          <div class="logo-circle">HR</div>
          <div>
            <div class="title-main">æ‹›å‹Ÿé¡§å• AI æ™ºèƒ½é«”</div>
            <div class="title-sub">Job Intake â†’ Sourcing â†’ Screening â†’ Interview</div>
          </div>
        </div>

        <div class="step-list">
          <div class="step-item" data-step="1" data-nav="tool">
            <div class="step-badge">1</div>
            <div>è·ç¼ºéœ€æ±‚ï¼ˆJob Intakeï¼‰</div>
          </div>
          <div class="step-item" data-step="2" data-nav="tool">
            <div class="step-badge">2</div>
            <div>äººæ‰æœå°‹ï¼ˆSourcingï¼‰</div>
          </div>
          <div class="step-item" data-step="3" data-nav="tool">
            <div class="step-badge">3</div>
            <div>åˆæ­¥ç¯©é¸ï¼ˆScreeningï¼‰</div>
          </div>
          <div class="step-item" data-step="4" data-nav="tool">
            <div class="step-badge">4</div>
            <div>é¢è©¦éšæ®µï¼ˆInterviewï¼‰</div>
          </div>
        </div>
      </div>

      <!-- å³å´å°è©±å€åŸŸ -->
      <div class="fullscreen-chat-main">
        <div class="fullscreen-chat-window" id="fullscreen-chat-window">
          <div class="chat-empty">
            é‚„æ²’æœ‰å°è©±ç´€éŒ„ï¼Œå¯ä»¥è©¦è©¦å•ï¼š<br />
            ã€Œå¹«æˆ‘å„ªåŒ–é€™å€‹å‰ªè¼¯å¸« JD çš„æ¨™é¡Œã€æˆ–ã€Œæˆ‘ç¾åœ¨é€™å€‹äººæ‰ç•«åƒåˆç†å—ï¼Ÿã€ã€‚
          </div>
        </div>

        <div class="fullscreen-chat-input-area">
          <div style="display: flex; gap: 8px; align-items: center;">
            <input
              type="text"
              class="chat-input"
              id="fullscreen-chat-input"
              placeholder="è¼¸å…¥æƒ³å• AI çš„å•é¡Œï¼Œä¾‹å¦‚ï¼šå¹«æˆ‘èª¿æ•´é€™å€‹è·ç¼ºçš„äº®é»æ•˜è¿°..."
              style="flex: 1;"
            />
            <button class="btn-chat" id="fullscreen-chat-send-btn">
              â¤ é€å‡º
            </button>
          </div>
          <div class="chat-status" id="fullscreen-chat-status" style="margin-top: 8px;">ç‹€æ…‹ï¼šå¾…æ©Ÿä¸­</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // === æ­¡è¿å‹•ç•«æ§åˆ¶ ===
    (function() {
      const welcomeScreen = document.getElementById("welcome-screen");
      const appShell = document.getElementById("app-shell");
      
      if (welcomeScreen && appShell) {
        // å‹•ç•«ç¸½æ™‚é•·ç´„ 2.5 ç§’ï¼Œç„¶å¾Œæ·¡å‡ºä¸¦éš±è—
        setTimeout(() => {
          welcomeScreen.classList.add("hidden");
          // åŒæ™‚é¡¯ç¤ºä¸»é é¢
          appShell.style.opacity = "1";
          // å‹•ç•«çµæŸå¾Œå®Œå…¨ç§»é™¤æ­¡è¿é é¢
          setTimeout(() => {
            welcomeScreen.style.display = "none";
          }, 800); // ç­‰å¾…æ·¡å‡ºå‹•ç•«å®Œæˆ
        }, 2500); // 2.5 ç§’å¾Œé–‹å§‹æ·¡å‡º
      }
    })();

    // === API è·¯å¾‘ ===
    const API_URL = "/api/hr-agent";    // å››å€‹åŠŸèƒ½çš„ç”Ÿæˆç”¨
    const CHAT_API_URL = "/api/hr-chat"; // è·Ÿ AI å°è©±ç”¨
    const SAVE_API_URL = "/api/hr-save"; // å„²å­˜çµæœç”¨
    const SAVED_API_URL = "/api/hr-saved"; // æŸ¥è©¢å·²å„²å­˜çµæœç”¨

    // === Session ID ç®¡ç†ï¼ˆä½¿ç”¨ localStorageï¼‰===
    function getSessionId() {
      let sessionId = localStorage.getItem('hr_session_id');
      if (!sessionId) {
        // ç”Ÿæˆæ–°çš„ session IDï¼ˆä½¿ç”¨æ™‚é–“æˆ³ + éš¨æ©Ÿæ•¸ï¼‰
        sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('hr_session_id', sessionId);
      }
      return sessionId;
    }

    const steps = document.querySelectorAll(".step-item");
    const mainTitle = document.getElementById("main-title");
    const mainSubtitle = document.getElementById("main-subtitle");
    const inputHint = document.getElementById("input-hint");
    const inputText = document.getElementById("input-text");
    const outputPre = document.getElementById("output-pre");
    const runBtn = document.getElementById("run-btn");
    const retryBtn = document.getElementById("retry-btn");
    const copyBtn = document.getElementById("copy-btn");
    const statusEl = document.getElementById("status");
    const toolModal = document.getElementById("tool-modal");
    const toolCloseBtn = document.getElementById("tool-close-btn");

    // å…¨å±å°è©±å…ƒä»¶
    const fullscreenChat = document.getElementById("fullscreen-chat");
    const fullscreenChatWindow = document.getElementById("fullscreen-chat-window");
    const fullscreenChatInput = document.getElementById("fullscreen-chat-input");
    const fullscreenChatSendBtn = document.getElementById("fullscreen-chat-send-btn");
    const fullscreenChatStatus = document.getElementById("fullscreen-chat-status");
    const closeFullscreenBtn = document.getElementById("close-fullscreen-chat-btn");
    const mobileNavToggle = document.getElementById("mobile-nav-toggle");
    const fullscreenChatSidebar = document.getElementById("fullscreen-chat-sidebar");
    const sidebarOverlay = document.getElementById("sidebar-overlay");
    const sidebarCloseBtn = document.getElementById("sidebar-close-btn");

    // å››éšæ®µè¨­å®š
    const STEP_CONFIG = {
      "1": {
        title: "â‘  è·ç¼ºéœ€æ±‚ï¼ˆJob Intakeï¼‰",
        subtitle: "HR è²¼ä¸Šè·ç¼ºèªªæ˜ï¼ˆJDï¼‰ â†’ AI è‡ªå‹•ç”Ÿæˆäººæ‰ç•«åƒèˆ‡çµæ§‹åŒ–æ¬„ä½",
        hint: "ç›®å‰æ­¥é©Ÿï¼šè·ç¼ºéœ€æ±‚ï¼ˆJob Intakeï¼‰ã€‚è«‹è²¼ä¸Šå®Œæ•´ JDã€‚",
        stepKey: "job_intake"
      },
      "2": {
        title: "â‘¡ äººæ‰æœå°‹ï¼ˆSourcingï¼‰",
        subtitle: "æ ¹æ“šè·ç¼ºè³‡è¨Šï¼Œç”¢å‡ºæ‹›å‹Ÿè²¼æ–‡ã€æœå°‹é—œéµå­—èˆ‡é‚€è«‹è¨Šæ¯",
        hint: "ç›®å‰æ­¥é©Ÿï¼šäººæ‰æœå°‹ï¼ˆSourcingï¼‰ã€‚å¯è²¼ä¸Šè·ç¼ºæ‘˜è¦ï¼Œè®“ AI å¹«ä½ ç”Ÿæ‹›å‹Ÿè²¼æ–‡èˆ‡é—œéµå­—ã€‚",
        stepKey: "sourcing"
      },
      "3": {
        title: "â‘¢ åˆæ­¥ç¯©é¸ï¼ˆScreeningï¼‰",
        subtitle: "è¼¸å…¥ JDï¼‹å±¥æ­· â†’ AI è©•ä¼°åŒ¹é…åº¦ã€å„ªå‹¢ã€é¢¨éšªèˆ‡å»ºè­°æå•",
        hint: "ç›®å‰æ­¥é©Ÿï¼šåˆæ­¥ç¯©é¸ï¼ˆScreeningï¼‰ã€‚å»ºè­°æ ¼å¼ï¼šå…ˆè²¼ JDï¼Œå†è²¼å±¥æ­·ï¼Œä¸­é–“ç”¨ --- åˆ†éš”ã€‚",
        stepKey: "screening"
      },
      "4": {
        title: "â‘£ é¢è©¦éšæ®µï¼ˆInterviewï¼‰",
        subtitle: "è²¼ä¸Šé¢è©¦é€å­—ç¨¿ â†’ AI ç”¢å‡ºæ‘˜è¦ã€å„ªå‹¢/ç–‘æ…®èˆ‡åˆ†æ•¸è©•ä¼°",
        hint: "ç›®å‰æ­¥é©Ÿï¼šé¢è©¦éšæ®µï¼ˆInterviewï¼‰ã€‚è«‹è²¼ä¸Šé¢è©¦é€å­—ç¨¿ï¼ˆå·²è½‰æ–‡å­—ï¼‰ã€‚",
        stepKey: "interview"
      }
    };

    let currentStep = "1";
    let lastResultPayload = null; // ç”¨ä¾†å­˜é€™æ¬¡ LLM çš„çµæœï¼Œçµ¦ã€Œå„²å­˜ã€ç”¨

    function setStatus(mode, text) {
      statusEl.className = "status " + (mode || "");
      statusEl.innerHTML = '<span class="dot"></span>' + (text || "");
    }

    function isMobile() {
      return window.innerWidth <= 900;
    }

    function openToolModal() {
      toolModal.classList.add("open");
      const homeWelcome = document.getElementById("home-welcome");
      if (homeWelcome) {
        homeWelcome.style.display = "none";
      }
    }

    function closeToolModal() {
      toolModal.classList.remove("open");
      const homeWelcome = document.getElementById("home-welcome");
      if (homeWelcome) {
        homeWelcome.style.display = "block";
      }
    }

    // åˆ‡æ›å››éšæ®µ UI
    steps.forEach((s) => {
      s.addEventListener("click", () => {
        steps.forEach((x) => x.classList.remove("active"));
        s.classList.add("active");
        const key = s.dataset.step;
        currentStep = key;

        const conf = STEP_CONFIG[key];
        mainTitle.textContent = conf.title;
        mainSubtitle.textContent = conf.subtitle;
        inputHint.textContent = conf.hint;

        outputPre.textContent =
          "å·²åˆ‡æ›åˆ°ï¼š" +
          conf.title +
          "ã€‚\nè²¼ä¸Šå…§å®¹å¾Œï¼Œé»ä¸‹æ–¹æŒ‰éˆ•é–‹å§‹åˆ†æã€‚";
        setStatus("", "å·²åˆ‡æ›æ­¥é©Ÿï¼Œç­‰å¾…é€å‡ºâ€¦");

        // åˆ‡æ›æ­¥é©Ÿå¾Œï¼Œæ¸…æ‰ä¸Šä¸€ç­†æš«å­˜çµæœ
        lastResultPayload = null;
        retryBtn.disabled = true;
        copyBtn.disabled = true;

        // æ‰‹æ©Ÿç‰ˆï¼šé»åŠŸèƒ½å°±æ‰“é–‹å·¥å…·å½ˆçª—
        openToolModal();
      });
    });

    // é—œé–‰å·¥å…·å½ˆçª—ï¼ˆåªå½±éŸ¿æ‰‹æ©Ÿï¼‰
    toolCloseBtn.addEventListener("click", () => {
      closeToolModal();
    });

    // å‘¼å« hr-agent çš„å…±ç”¨ function
    async function callHrAgent(isRetry = false) {
      const text = inputText.value.trim();
      if (!text) {
        setStatus("error", "è«‹å…ˆåœ¨å·¦å´è²¼ä¸Šå…§å®¹ï¼Œå†é–‹å§‹åˆ†æã€‚");
        return;
      }

      const conf = STEP_CONFIG[currentStep];

      runBtn.disabled = true;
      retryBtn.disabled = true;
      copyBtn.disabled = true;

      const actionText = isRetry ? "ï¼ˆå†æ›ä¸€å€‹ï¼‰" : "";
      setStatus(
        "loading",
        "æ­£åœ¨è™•ç†ä¸­ï¼Œè«‹ç¨å€™â€¦" + actionText
      );
      outputPre.textContent = "è«‹ç¨å€™ï¼ŒAI æ­£åœ¨åˆ†æä¸­â€¦";

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            step: conf.stepKey,
            input: text,
            mode: isRetry ? "retry" : "normal"
          })
        });

        if (!res.ok) {
          throw new Error("HTTP ç‹€æ…‹ç¢¼ " + res.status);
        }

        const data = await res.json();

        let displayText;

        if (data == null) {
          displayText = "æœªæ”¶åˆ°æœ‰æ•ˆçµæœï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
        } else if (typeof data.result === "string") {
          displayText = data.result;
        } else if (data.result) {
          // å¦‚æœæ˜¯ç‰©ä»¶ï¼Œè½‰æ›ç‚ºè‡ªç„¶èªè¨€æ ¼å¼
          displayText = typeof data.result === 'object' 
            ? JSON.stringify(data.result, null, 2) 
            : String(data.result);
        } else {
          displayText = JSON.stringify(data, null, 2);
        }

        // å…ˆæ¸…ç†æ¨™è¨˜ï¼Œå†è½‰æ› markdown æ ¼å¼
        // ä½¿ç”¨çµ±ä¸€çš„æ¸…ç†å‡½æ•¸ï¼Œç¢ºä¿æ‰€æœ‰è®Šé«”éƒ½è¢«ç§»é™¤
        let cleanedText = cleanStrongMarkersFrontend(displayText);
        
        // èª¿è©¦ï¼šæª¢æŸ¥æ˜¯å¦é‚„æœ‰æ¨™è¨˜ï¼ˆåƒ…åœ¨é–‹ç™¼æ™‚ï¼‰
        if (cleanedText.includes('STRONGSTART') || cleanedText.includes('STRONGEND')) {
          console.warn('[å‰ç«¯æ¸…ç†] è­¦å‘Šï¼šæ¸…ç†å¾Œä»ç™¼ç¾æ¨™è¨˜ï¼Œå°‡å†æ¬¡æ¸…ç†');
          cleanedText = cleanStrongMarkersFrontend(cleanedText); // å†æ¬¡æ¸…ç†
        }
        
        // ä½¿ç”¨ innerHTML ä¸¦è½‰æ› markdown æ ¼å¼ï¼ˆç§»é™¤ ** å’Œ * ç¬¦è™Ÿï¼Œè½‰ç‚º HTMLï¼‰
        outputPre.innerHTML = markdownToNaturalLanguage(cleanedText);
        setStatus("", "åˆ†æå®Œæˆï¼");

        // â­ å­˜èµ·ä¾†çµ¦ã€Œè¤‡è£½ã€ç”¨ï¼ˆä¿å­˜æ¸…ç†å¾Œçš„æ–‡æœ¬ï¼‰
        lastResultPayload = {
          step: conf.stepKey,
          input: text,
          result: cleanedText  // ä¿å­˜æ¸…ç†å¾Œçš„æ–‡æœ¬ï¼Œè€Œä¸æ˜¯åŸå§‹æ–‡æœ¬
        };

        // è‡ªå‹•å„²å­˜åˆ°è³‡æ–™åº«ï¼ˆä½¿ç”¨ session IDï¼‰
        try {
          const saveRes = await fetch(SAVE_API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              step: conf.stepKey,
              input: text,
              result: cleanedText,  // å„²å­˜æ¸…ç†å¾Œçš„æ–‡æœ¬
              user_id: getSessionId()
            })
          });
          if (saveRes.ok) {
            const saveData = await saveRes.json();
            console.log(`[è‡ªå‹•å„²å­˜] å·²å„²å­˜çµæœï¼ŒID: ${saveData.id}`);
          } else {
            console.warn('[è‡ªå‹•å„²å­˜] å„²å­˜å¤±æ•—ï¼Œä½†ä¸å½±éŸ¿ä½¿ç”¨');
          }
        } catch (saveErr) {
          console.warn('[è‡ªå‹•å„²å­˜] å„²å­˜éŒ¯èª¤:', saveErr);
          // å„²å­˜å¤±æ•—ä¸å½±éŸ¿ä¸»è¦åŠŸèƒ½
        }

        // é€™æ™‚å€™æ‰èƒ½å†æŒ‰ã€Œå†æ›ä¸€å€‹ã€å’Œã€Œè¤‡è£½ã€
        retryBtn.disabled = false;
        copyBtn.disabled = false;
      } catch (err) {
        console.error(err);
        setStatus("error", "è™•ç†å¤±æ•—ï¼š" + err.message);
        outputPre.textContent =
          "è™•ç†éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚\n\n" +
          "éŒ¯èª¤è¨Šæ¯ï¼š" + err.message;
      } finally {
        runBtn.disabled = false;
      }
    }

    // âš¡é€å‡º
    runBtn.addEventListener("click", () => callHrAgent(false));
    // ğŸ” å†æ›ä¸€å€‹ï¼ˆåŒæ¨£ step & input å†å«ä¸€æ¬¡ï¼‰
    retryBtn.addEventListener("click", () => callHrAgent(true));

    // ğŸ“‹ è¤‡è£½ç›®å‰çµæœ
    copyBtn.addEventListener("click", async () => {
      if (!lastResultPayload || !lastResultPayload.result) {
        setStatus("error", "ç›®å‰æ²’æœ‰å¯ä»¥è¤‡è£½çš„çµæœï¼Œè«‹å…ˆè®“ AI ç”Ÿæˆä¸€æ¬¡ã€‚");
        return;
      }

      try {
        const textToCopy = typeof lastResultPayload.result === 'string' 
          ? lastResultPayload.result 
          : JSON.stringify(lastResultPayload.result, null, 2);
        
        await navigator.clipboard.writeText(textToCopy);
        setStatus("", "å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
        
        // 2 ç§’å¾Œæ¢å¾©ç‹€æ…‹
        setTimeout(() => {
          setStatus("", "åˆ†æå®Œæˆï¼");
        }, 2000);
      } catch (err) {
        console.error(err);
        // å¦‚æœ clipboard API ä¸å¯ç”¨ï¼Œä½¿ç”¨å‚³çµ±æ–¹æ³•
        try {
          const textArea = document.createElement("textarea");
          const textToCopy = typeof lastResultPayload.result === 'string' 
            ? lastResultPayload.result 
            : JSON.stringify(lastResultPayload.result, null, 2);
          textArea.value = textToCopy;
          textArea.style.position = "fixed";
          textArea.style.opacity = "0";
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand("copy");
          document.body.removeChild(textArea);
          setStatus("", "å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
          setTimeout(() => {
            setStatus("", "åˆ†æå®Œæˆï¼");
          }, 2000);
        } catch (fallbackErr) {
          setStatus("error", "è¤‡è£½å¤±æ•—ï¼š" + err.message);
        }
      }
    });

    // === Chat åŠŸèƒ½ ===
    let chatHistory = []; // { role: 'user' | 'assistant', content: string }
    let isThinking = false;

    // æ¸…ç† LLM è¼¸å‡ºä¸­çš„å¥‡æ€ªæ¨™è¨˜ï¼ˆèˆ‡å¾Œç«¯ä½¿ç”¨ç›¸åŒçš„é‚è¼¯ï¼‰
    function cleanStrongMarkersFrontend(text) {
      if (!text) return text;
      
      let cleaned = text;
      // å¤šæ¬¡æ¸…ç†ç¢ºä¿æ‰€æœ‰è®Šé«”éƒ½è¢«ç§»é™¤
      // æ³¨æ„ï¼šå…ˆåŸ·è¡Œæœ€å¯¬é¬†çš„æ¨¡å¼ï¼Œç¢ºä¿æ‰€æœ‰æ¨™è¨˜éƒ½è¢«ç§»é™¤
      
      // æ¨¡å¼0: æœ€å¯¬é¬†çš„æ¨¡å¼ï¼Œç›´æ¥ç§»é™¤é—œéµå­—ï¼ˆå„ªå…ˆåŸ·è¡Œï¼‰
      cleaned = cleaned.replace(/STRONGSTART/gi, '');
      cleaned = cleaned.replace(/STRONGEND/gi, '');
      
      // æ¨¡å¼1: åŒ¹é… _STRONGSTART_ æˆ– _STRONGEND_ï¼ˆä»»æ„æ•¸é‡çš„åº•ç·šï¼‰
      cleaned = cleaned.replace(/_+STRONGSTART_+/gi, '');
      cleaned = cleaned.replace(/_+STRONGEND_+/gi, '');
      
      // æ¨¡å¼2: åŒ¹é… _STRONG_START_ æˆ– _STRONG_END_ï¼ˆä¸­é–“æœ‰åº•ç·šï¼‰
      cleaned = cleaned.replace(/_+STRONG_START_+/gi, '');
      cleaned = cleaned.replace(/_+STRONG_END_+/gi, '');
      
      // æ¨¡å¼3: åŒ¹é… _STRONG START_ æˆ– _STRONG END_ï¼ˆä¸­é–“æœ‰ç©ºæ ¼ï¼‰
      cleaned = cleaned.replace(/_+STRONG\s*START_+/gi, '');
      cleaned = cleaned.replace(/_+STRONG\s*END_+/gi, '');
      
      // æ¨¡å¼4: åŒ¹é…ä»»æ„æ•¸é‡çš„åº•ç·š/ç©ºæ ¼ + STRONG + ä»»æ„å­—ç¬¦ + START/END + ä»»æ„æ•¸é‡çš„åº•ç·š/ç©ºæ ¼
      cleaned = cleaned.replace(/[_\s]*STRONG[_\s]*START[_\s]*/gi, '');
      cleaned = cleaned.replace(/[_\s]*STRONG[_\s]*END[_\s]*/gi, '');
      
      // æ¨¡å¼5: åŒ¹é…ä»»æ„æ•¸é‡çš„åº•ç·š/ç©ºæ ¼ + STRONGSTART/STRONGEND + ä»»æ„æ•¸é‡çš„åº•ç·š/ç©ºæ ¼
      cleaned = cleaned.replace(/[_\s]*STRONGSTART[_\s]*/gi, '');
      cleaned = cleaned.replace(/[_\s]*STRONGEND[_\s]*/gi, '');
      
      // æ¨¡å¼6: å†æ¬¡åŸ·è¡Œæœ€å¯¬é¬†çš„æ¨¡å¼ï¼ˆç¢ºä¿æ²’æœ‰éºæ¼ï¼‰
      cleaned = cleaned.replace(/STRONGSTART/gi, '');
      cleaned = cleaned.replace(/STRONGEND/gi, '');
      
      // æ¨¡å¼7: é¡å¤–æ¸…ç†ï¼Œç¢ºä¿ç§»é™¤ä»»ä½•æ®˜ç•™çš„åº•ç·šçµ„åˆ
      cleaned = cleaned.replace(/_{2,}/g, ''); // ç§»é™¤å¤šå€‹é€£çºŒçš„åº•ç·š
      
      return cleaned;
    }

    // å°‡ markdown è½‰æ›ç‚ºè‡ªç„¶èªè¨€ HTMLï¼ˆç§»é™¤ markdown èªæ³•ï¼Œä¿ç•™æ ¼å¼ï¼‰
    function markdownToNaturalLanguage(text) {
      if (!text) return '';
      
      // å…ˆç§»é™¤ LLM å¯èƒ½è¼¸å‡ºçš„å¥‡æ€ªæ¨™è¨˜ï¼ˆå¦‚ _STRONGSTART_ã€_STRONGEND_ ç­‰ï¼‰
      // ä½¿ç”¨èˆ‡å¾Œç«¯ç›¸åŒçš„æ¸…ç†é‚è¼¯ï¼Œç¢ºä¿æ‰€æœ‰è®Šé«”éƒ½è¢«ç§»é™¤
      text = cleanStrongMarkersFrontend(text);
      
      // å…ˆè½‰ç¾© HTML ç‰¹æ®Šå­—ç¬¦ï¼Œé¿å… XSS
      const escapeHtml = (str) => {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      };
      text = escapeHtml(text);
      
      // ç§»é™¤ä»£ç¢¼å¡Šï¼ˆå¤šè¡Œå’Œå–®è¡Œï¼‰
      text = text.replace(/```[\s\S]*?```/g, '');
      text = text.replace(/`([^`\n]+)`/g, '$1');
      
      // è½‰æ›ç²—é«” **text** æˆ– __text__ â†’ <strong>text</strong>ï¼ˆå„ªå…ˆè™•ç†ï¼‰
      // å…ˆè™•ç† **text**ï¼ˆé›™æ˜Ÿè™Ÿï¼‰
      text = text.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
      // å†è™•ç† __text__ï¼ˆé›™åº•ç·šï¼‰ï¼Œä½†è¦é¿å…åŒ¹é… HTML æ¨™ç±¤å…§çš„å…§å®¹
      text = text.replace(/__([^_]+)__/g, function(match, p1) {
        // å¦‚æœä¸åœ¨ HTML æ¨™ç±¤å…§ï¼Œæ‰æ›¿æ›
        if (!match.includes('<') && !match.includes('>')) {
          return '<strong>' + p1 + '</strong>';
        }
        return match;
      });
      
      // è½‰æ›æ–œé«” *text* æˆ– _text_ â†’ <em>text</em>
      // ä½¿ç”¨è‡¨æ™‚æ¨™è¨˜é¿å…èˆ‡ç²—é«”è¡çª
      text = text.replace(/<strong>([^<]+)<\/strong>/g, '___STRONG_START___$1___STRONG_END___');
      // è™•ç†å–®æ˜Ÿè™Ÿæ–œé«”ï¼ˆä½†è¦é¿å…åŒ¹é…å·²è™•ç†çš„ç²—é«”ï¼‰
      text = text.replace(/\*([^*]+)\*/g, '<em>$1</em>');
      // è™•ç†å–®åº•ç·šæ–œé«”ï¼ˆä½†è¦é¿å…åŒ¹é…å·²è™•ç†çš„æ¨™ç±¤å’Œç²—é«”ï¼‰
      text = text.replace(/_([^_]+)_/g, function(match, p1) {
        // å¦‚æœä¸åœ¨ HTML æ¨™ç±¤æˆ–è‡¨æ™‚æ¨™è¨˜å…§ï¼Œæ‰æ›¿æ›
        if (!match.includes('<') && !match.includes('>') && 
            !match.includes('___STRONG_START___') && !match.includes('___STRONG_END___')) {
          return '<em>' + p1 + '</em>';
        }
        return match;
      });
      text = text.replace(/___STRONG_START___/g, '<strong>');
      text = text.replace(/___STRONG_END___/g, '</strong>');
      
      // ç§»é™¤åˆ—è¡¨æ¨™è¨˜ï¼ˆ-ã€*ã€æ•¸å­—ï¼‰ï¼Œä½†ä¿ç•™å…§å®¹
      text = text.replace(/^[\s]*[-*â€¢]\s+/gm, '');
      text = text.replace(/^\d+\.\s+/gm, '');
      
      // ç§»é™¤æ¨™é¡Œæ¨™è¨˜ï¼ˆ#ã€##ã€###ï¼‰
      text = text.replace(/^#{1,6}\s+/gm, '');
      
      // ç§»é™¤ markdown é€£çµèªæ³• [text](url) â†’ text
      text = text.replace(/\[([^\]]+)\]\([^\)]+\)/g, '$1');
      
      // ç§»é™¤å…¶ä»– markdown èªæ³•
      text = text.replace(/~~([^~]+)~~/g, '$1'); // åˆªé™¤ç·š
      text = text.replace(/^>\s+/gm, ''); // å¼•ç”¨
      
      // ä¿ç•™æ›è¡Œï¼ˆ\n è½‰ç‚º <br>ï¼‰
      text = text.replace(/\n/g, '<br>');
      
      // ç§»é™¤å¤šé¤˜çš„ç©ºç™½è¡Œ
      text = text.replace(/(<br>\s*){3,}/g, '<br><br>');
      
      return text.trim();
    }

    // æ¸²æŸ“èŠå¤©è¨Šæ¯åˆ°æŒ‡å®šå®¹å™¨
    function renderChatToContainer(container) {
      if (!chatHistory.length && !isThinking) {
        container.innerHTML =
          '<div class="chat-empty">é‚„æ²’æœ‰å°è©±ç´€éŒ„ï¼Œå¯ä»¥è©¦è©¦å•ï¼š<br />ã€Œå¹«æˆ‘å„ªåŒ–é€™å€‹å‰ªè¼¯å¸« JD çš„æ¨™é¡Œã€æˆ–ã€Œæˆ‘ç¾åœ¨é€™å€‹äººæ‰ç•«åƒåˆç†å—ï¼Ÿã€ã€‚</div>';
        return;
      }

      container.innerHTML = "";
      chatHistory.forEach((msg) => {
        const row = document.createElement("div");
        row.className = "chat-msg " + (msg.role === "user" ? "me" : "ai");

        const bubble = document.createElement("div");
        bubble.className = "chat-bubble";

        const roleLabel = document.createElement("div");
        roleLabel.className = "chat-role";
        roleLabel.textContent = msg.role === "user" ? "ä½ ï¼š" : "AIï¼š";

        const content = document.createElement("div");
        content.className = "chat-content";
        // ä½¿ç”¨ innerHTML ä¾†é¡¯ç¤ºæ ¼å¼åŒ–çš„å…§å®¹
        content.innerHTML = markdownToNaturalLanguage(msg.content);

        bubble.appendChild(roleLabel);
        bubble.appendChild(content);
        row.appendChild(bubble);
        container.appendChild(row);
      });

      // å¦‚æœæ­£åœ¨æ€è€ƒï¼Œé¡¯ç¤ºæ€è€ƒå‹•ç•«
      if (isThinking) {
        const row = document.createElement("div");
        row.className = "chat-msg ai";

        const bubble = document.createElement("div");
        bubble.className = "chat-bubble";

        const roleLabel = document.createElement("div");
        roleLabel.className = "chat-role";
        roleLabel.textContent = "AIï¼š";

        const thinkingDiv = document.createElement("div");
        thinkingDiv.className = "thinking";
        thinkingDiv.innerHTML = 'AIæ€è€ƒä¸­<span class="thinking-dot"></span><span class="thinking-dot"></span><span class="thinking-dot"></span>';

        bubble.appendChild(roleLabel);
        bubble.appendChild(thinkingDiv);
        row.appendChild(bubble);
        container.appendChild(row);
      }

      container.scrollTop = container.scrollHeight;
    }

    // æ¸²æŸ“èŠå¤©è¨Šæ¯ï¼ˆåªæ¸²æŸ“åˆ°å…¨å±å°è©±çª—å£ï¼‰
    function renderChat() {
      if (fullscreenChat.classList.contains('active')) {
        renderChatToContainer(fullscreenChatWindow);
      }
    }

    function setChatStatus(text) {
      if (fullscreenChat.classList.contains('active')) {
        fullscreenChatStatus.textContent = "ç‹€æ…‹ï¼š" + text;
      }
    }

    async function sendChat(inputElement, sendBtn) {
      const text = inputElement.value.trim();
      if (!text) return;

      chatHistory.push({ role: "user", content: text });
      inputElement.value = "";
      
      // é¡¯ç¤ºæ€è€ƒå‹•ç•«
      isThinking = true;
      renderChat();

      sendBtn.disabled = true;
      setChatStatus("AI æ­£åœ¨æ€è€ƒâ€¦");

      try {
        // æŸ¥è©¢æ­·å²çµæœä½œç‚ºä¸Šä¸‹æ–‡ï¼ˆåªåœ¨ç¬¬ä¸€æ¬¡å°è©±æ™‚åŠ å…¥ï¼Œé¿å…é‡è¤‡ï¼‰
        let contextMessages = [...chatHistory];
        const isFirstMessage = chatHistory.length === 1; // åªæœ‰ä¸€æ¢è¨Šæ¯ï¼ˆå‰›åŠ å…¥çš„ç”¨æˆ¶å•é¡Œï¼‰
        
        if (isFirstMessage) {
          try {
            const savedRes = await fetch(`${SAVED_API_URL}?limit=10&user_id=${getSessionId()}`);
            if (savedRes.ok) {
              const savedData = await savedRes.json();
              if (savedData.items && savedData.items.length > 0) {
                // å°‡æ­·å²çµæœä½œç‚ºä¸Šä¸‹æ–‡åŠ å…¥
                const contextText = savedData.items.map((item, idx) => {
                  const stepNames = {
                    'job_intake': 'è·ç¼ºéœ€æ±‚',
                    'sourcing': 'äººæ‰æœå°‹',
                    'screening': 'åˆæ­¥ç¯©é¸',
                    'interview': 'é¢è©¦éšæ®µ'
                  };
                  const stepName = stepNames[item.step] || item.step;
                  const resultPreview = typeof item.result === 'string' 
                    ? item.result.substring(0, 500) 
                    : JSON.stringify(item.result).substring(0, 500);
                  return `ã€${stepName}ã€‘\nè¼¸å…¥ï¼š${item.input_preview}\nçµæœï¼š${resultPreview}`;
                }).join('\n\n');
                
                // åœ¨å°è©±é–‹å§‹å‰åŠ å…¥ä¸Šä¸‹æ–‡è¨Šæ¯
                contextMessages = [
                  {
                    role: "user",
                    content: `ä»¥ä¸‹æ˜¯æˆ‘ä¹‹å‰ä½¿ç”¨å››å¤§åŠŸèƒ½ç”¢ç”Ÿçš„çµæœï¼Œè«‹åƒè€ƒé€™äº›è³‡è¨Šä¾†å›ç­”æˆ‘çš„å•é¡Œï¼š\n\n${contextText}\n\n---\n\nç¾åœ¨æˆ‘çš„å•é¡Œæ˜¯ï¼š${text}`
                  }
                ];
              }
            }
          } catch (contextErr) {
            console.warn('[ä¸Šä¸‹æ–‡æŸ¥è©¢] æŸ¥è©¢å¤±æ•—ï¼Œä½†ä¸å½±éŸ¿å°è©±:', contextErr);
            // æŸ¥è©¢å¤±æ•—æ™‚ä½¿ç”¨åŸå§‹å°è©±æ­·å²
          }
        }

        // ä½¿ç”¨æµå¼è¼¸å‡º
        const res = await fetch(CHAT_API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            messages: contextMessages,
            stream: true
          })
        });

        if (!res.ok) {
          throw new Error("HTTP ç‹€æ…‹ç¢¼ " + res.status);
        }

        // ç§»é™¤æ€è€ƒå‹•ç•«ï¼Œæº–å‚™é€å­—é¡¯ç¤º
        isThinking = false;
        let fullReply = '';
        chatHistory.push({ role: "assistant", content: "" });
        
        // è®€å–æµå¼å›æ‡‰
        const reader = res.body.getReader();
        const decoder = new TextDecoder();
        
        while (true) {
          const { done, value } = await reader.read();
          if (done) break;
          
          const chunk = decoder.decode(value, { stream: true });
          const lines = chunk.split('\n');
          
          for (const line of lines) {
            if (line.startsWith('data: ')) {
              try {
                const data = JSON.parse(line.slice(6));
                if (data.chunk) {
                  fullReply += data.chunk;
                  // æ›´æ–°æœ€å¾Œä¸€æ¢è¨Šæ¯ä¸¦é‡æ–°æ¸²æŸ“
                  // æ³¨æ„ï¼šé€™è£¡ä¸éœ€è¦æ¸…ç†æ¨™è¨˜ï¼Œå› ç‚º renderChat æœƒèª¿ç”¨ markdownToNaturalLanguage ä¾†è™•ç†
                  chatHistory[chatHistory.length - 1].content = fullReply;
                  renderChat();
                } else if (data.done) {
                  setChatStatus("å·²æ”¶åˆ°å›è¦†");
                  sendBtn.disabled = false;
                  return;
                } else if (data.error) {
                  throw new Error(data.error);
                }
              } catch (parseErr) {
                // å¿½ç•¥è§£æéŒ¯èª¤ï¼Œç¹¼çºŒè™•ç†ä¸‹ä¸€è¡Œ
                console.warn('è§£æ SSE æ•¸æ“šå¤±æ•—:', parseErr);
              }
            }
          }
        }
        
        setChatStatus("å·²æ”¶åˆ°å›è¦†");
      } catch (err) {
        console.error(err);
        isThinking = false;
        // å¦‚æœå·²ç¶“æ·»åŠ äº† assistant è¨Šæ¯ä½†å‡ºéŒ¯ï¼Œç§»é™¤å®ƒ
        if (chatHistory.length > 0 && chatHistory[chatHistory.length - 1].role === 'assistant' && !chatHistory[chatHistory.length - 1].content) {
          chatHistory.pop();
        }
        renderChat();
        setChatStatus("è™•ç†å¤±æ•—ï¼š" + err.message);
      } finally {
        sendBtn.disabled = false;
      }
    }

    // å…¨å±å°è©±çš„èŠå¤©æŒ‰éˆ•
    fullscreenChatSendBtn.addEventListener("click", () => sendChat(fullscreenChatInput, fullscreenChatSendBtn));
    fullscreenChatInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendChat(fullscreenChatInput, fullscreenChatSendBtn);
      }
    });

    // é€²å…¥å…¨å±å°è©±ï¼ˆå¾å´é‚Šæ¬„æŒ‰éˆ•ï¼‰
    const sidebarEnterChatBtn = document.getElementById("sidebar-enter-chat-btn");
    if (sidebarEnterChatBtn) {
      sidebarEnterChatBtn.addEventListener("click", () => {
        fullscreenChat.classList.add("active");
        renderChat(); // ç¢ºä¿å…¨å±å°è©±é¡¯ç¤ºæœ€æ–°çš„èŠå¤©è¨˜éŒ„
        fullscreenChatInput.focus();
      });
    }


    // é—œé–‰å…¨å±å°è©±
    closeFullscreenBtn.addEventListener("click", () => {
      fullscreenChat.classList.remove("active");
      if (fullscreenChatSidebar) {
        fullscreenChatSidebar.classList.remove("open");
      }
      if (sidebarOverlay) {
        sidebarOverlay.classList.remove("open");
      }
    });

    // æ‰‹æ©Ÿç‰ˆå°èˆªåˆ‡æ›
    if (mobileNavToggle) {
      mobileNavToggle.addEventListener("click", () => {
        const isOpen = fullscreenChatSidebar.classList.contains("open");
        fullscreenChatSidebar.classList.toggle("open");
        if (sidebarOverlay) {
          sidebarOverlay.classList.toggle("open", !isOpen);
        }
        // é¡¯ç¤º/éš±è—é—œé–‰æŒ‰éˆ•
        if (sidebarCloseBtn) {
          sidebarCloseBtn.style.display = isOpen ? "none" : "flex";
        }
      });
      
      // é»æ“Šé®ç½©é—œé–‰å´é‚Šæ¬„
      if (sidebarOverlay) {
        sidebarOverlay.addEventListener("click", () => {
          fullscreenChatSidebar.classList.remove("open");
          sidebarOverlay.classList.remove("open");
          if (sidebarCloseBtn) {
            sidebarCloseBtn.style.display = "none";
          }
        });
      }
    }

    // å°èˆªåˆ—é—œé–‰æŒ‰éˆ•ï¼ˆåªé—œé–‰å°èˆªåˆ—ï¼Œä¸é—œé–‰å°è©±ï¼‰
    if (sidebarCloseBtn) {
      sidebarCloseBtn.addEventListener("click", () => {
        fullscreenChatSidebar.classList.remove("open");
        if (sidebarOverlay) {
          sidebarOverlay.classList.remove("open");
        }
        sidebarCloseBtn.style.display = "none";
      });
    }

    // å…¨å±å°è©±ä¸­çš„å°èˆªåˆ—ï¼šé»æ“Šå¾Œåˆ‡æ›å›å››å¤§åŠŸèƒ½
    const fullscreenNavItems = fullscreenChat.querySelectorAll(".step-item[data-nav='tool']");
    fullscreenNavItems.forEach((item) => {
      item.addEventListener("click", () => {
        const stepKey = item.dataset.step;
        
        // é—œé–‰æ‰‹æ©Ÿç‰ˆå´é‚Šæ¬„
        if (fullscreenChatSidebar) {
          fullscreenChatSidebar.classList.remove("open");
        }
        if (sidebarOverlay) {
          sidebarOverlay.classList.remove("open");
        }
        
        // é—œé–‰å…¨å±å°è©±
        fullscreenChat.classList.remove("active");
        
        // åˆ‡æ›åˆ°å°æ‡‰çš„åŠŸèƒ½
        steps.forEach((s) => {
          if (s.dataset.step === stepKey) {
            s.click(); // è§¸ç™¼åŸæœ¬çš„åˆ‡æ›é‚è¼¯
          }
        });
      });
    });

    // åˆå§‹åŒ– chat ç•«é¢
    renderChat();
  </script>
</body>
</html>
