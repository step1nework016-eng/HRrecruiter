<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ‹›å‹Ÿé¡§å• AI æ™ºèƒ½é«”ï¼ˆRWDï¼‹å·¥å…·å½ˆçª—ï¼‹èŠå¤©ï¼‹å„²å­˜ï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #ffffff;
      --card: #ffffff;
      --accent: #0ea5e9;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-soft: #6b7280;
      --radius-lg: 16px;
      --radius-xl: 22px;
      --shadow-soft: 0 8px 24px rgba(15, 23, 42, 0.06);
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans TC", sans-serif;
    }
    body {
      background: var(--bg);
      color: var(--text-main);
      margin: 0;
      padding: 32px 16px;
      display: flex;
      justify-content: center;
    }
    .app-shell {
      width: 100%;
      max-width: 1200px;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 24px;
    }
    @media (max-width: 900px) {
      .app-shell {
        grid-template-columns: 1fr;
        padding-bottom: 16px;
      }
      body {
        padding: 16px;
      }
    }
    .card {
      background: var(--card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      padding: 20px;
    }
    /* å´é‚Šæ¬„ */
    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
    }
    .logo-circle {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: linear-gradient(135deg, #0ea5e9, #38bdf8);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 16px;
    }
    .title-main {
      font-weight: 700;
      font-size: 16px;
    }
    .title-sub {
      font-size: 12px;
      color: var(--text-soft);
    }
    .step-list {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .step-item {
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid transparent;
      color: var(--text-soft);
      cursor: pointer;
      transition: 0.18s;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .step-item:hover {
      background: #f9fafb;
    }
    .step-item.active {
      border-color: var(--accent);
      background: #f0f9ff;
      color: var(--accent);
    }
    .step-badge {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }
    .step-item.active .step-badge {
      border-color: var(--accent);
      color: var(--accent);
    }
    .sidebar-footer {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px dashed #e5e7eb;
      font-size: 11px;
      color: var(--text-soft);
      line-height: 1.5;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 4px 8px;
      margin-top: 6px;
      font-size: 10px;
      background: #f9fafb;
    }

    /* ä¸»ç•«é¢å…±ç”¨ï¼ˆæ¡Œæ©Ÿ+æ‰‹æ©Ÿï¼‰ */
    .main-title-wrap {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .main-title {
      font-size: 18px;
      font-weight: 700;
    }
    .main-subtitle {
      font-size: 12px;
      color: var(--text-soft);
    }
    .badge-ai {
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 5px 10px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #f9fafb;
      white-space: nowrap;
    }
    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.18);
    }
    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    /* å·¥å…·å€ï¼šæ¡Œæ©Ÿç‰ˆç‚ºå…§åµŒï¼Œæ‰‹æ©Ÿç‰ˆç‚ºå…¨è¢å¹•å½ˆçª— */
    .tool-modal {
      margin-bottom: 12px;
    }
    .tool-close-btn {
      display: none;
    }

    .panel {
      margin-top: 8px;
      display: grid;
      grid-template-columns: 1.15fr 1.35fr;
      gap: 20px;
    }
    @media (max-width: 900px) {
      .panel {
        grid-template-columns: 1fr;
      }
      .tool-modal {
        position: fixed;
        inset: 0;
        padding: 16px;
        background: #f3f4f6;
        z-index: 50;
        overflow-y: auto;
        display: none;
      }
      .tool-modal.open {
        display: block;
      }
      .badge-ai {
        display: none;
      }
      .tool-close-btn {
        display: inline-flex;
        border-radius: 999px;
        border: 1px solid #e5e7eb;
        padding: 4px 10px;
        font-size: 12px;
        background: #ffffff;
        cursor: pointer;
        align-items: center;
        gap: 4px;
      }
      .tool-inner-card {
        background: #ffffff;
        border-radius: 18px;
        border: 1px solid #e5e7eb;
        box-shadow: var(--shadow-soft);
        padding: 16px;
      }
    }
    @media (min-width: 901px) {
      .tool-inner-card {
        padding: 0;
      }
    }

    .panel h4 {
      font-size: 13px;
      margin-bottom: 6px;
    }
    .hint {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 6px;
    }
    textarea {
      width: 100%;
      min-height: 190px;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      font-size: 13px;
      resize: vertical;
      outline: none;
    }
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(14, 165, 233, 0.4);
    }
    pre {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: var(--radius-lg);
      padding: 12px;
      font-size: 12px;
      line-height: 1.5;
      overflow: auto;
      max-height: 320px;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .toolbar {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      font-size: 11px;
      color: var(--text-soft);
    }
    .btn-primary {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 8px 18px rgba(14, 165, 233, 0.35);
    }
    .btn-primary:hover {
      background: #0284c7;
    }
    .btn-primary[disabled] {
      opacity: 0.7;
      cursor: default;
      box-shadow: none;
    }
    .status {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 6px;
    }
    .status .dot {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      margin-right: 4px;
      background: #9ca3af;
    }
    .status.loading .dot {
      background: #0ea5e9;
      box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.18);
    }
    .status.error .dot {
      background: #ef4444;
      box-shadow: 0 0 0 4px rgba(248, 113, 113, 0.18);
    }
    .chip-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 10px;
    }
    .chip {
      padding: 4px 8px;
      border-radius: 999px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      color: var(--text-soft);
    }

    /* Chat å€å¡Šï¼šé—œæ‰å·¥å…·å¾Œæ‰‹æ©Ÿåªæœƒçœ‹åˆ°é€™å€‹ */
    .chat-card {
      margin-top: 10px;
    }
    .chat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .chat-title {
      font-size: 14px;
      font-weight: 600;
    }
    .chat-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }
    .chat-window {
      border-radius: var(--radius-lg);
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 10px;
      max-height: 260px;
      overflow-y: auto;
      font-size: 13px;
    }
    .chat-empty {
      font-size: 12px;
      color: var(--text-soft);
    }
    .chat-msg {
      margin-bottom: 8px;
      display: flex;
      gap: 8px;
    }
    .chat-msg.me {
      justify-content: flex-end;
    }
    .chat-bubble {
      max-width: 80%;
      padding: 8px 10px;
      border-radius: 14px;
      line-height: 1.5;
    }
    .chat-msg.me .chat-bubble {
      background: #0ea5e9;
      color: #fff;
      border-bottom-right-radius: 2px;
    }
    .chat-msg.ai .chat-bubble {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-bottom-left-radius: 2px;
    }
    .chat-role {
      font-size: 10px;
      color: var(--text-soft);
      margin-bottom: 2px;
    }
    .chat-input-row {
      margin-top: 8px;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .chat-input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      font-size: 13px;
      outline: none;
      background: #ffffff;
    }
    .chat-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(14, 165, 233, 0.3);
    }
    .btn-chat {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 13px;
      background: #0ea5e9;
      color: #fff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .btn-chat[disabled] {
      opacity: 0.6;
      cursor: default;
    }
    .chat-status {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-soft);
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- å´é‚Šæ¬„ -->
    <aside class="card">
      <div class="sidebar-header">
        <div class="logo-circle">HR</div>
        <div>
          <div class="title-main">æ‹›å‹Ÿé¡§å• AI æ™ºèƒ½é«”</div>
          <div class="title-sub">Job Intake â†’ Sourcing â†’ Screening â†’ Interview</div>
        </div>
      </div>

      <div class="step-list">
        <div class="step-item active" data-step="1">
          <div class="step-badge">1</div>
          <div>è·ç¼ºéœ€æ±‚ï¼ˆJob Intakeï¼‰</div>
        </div>
        <div class="step-item" data-step="2">
          <div class="step-badge">2</div>
          <div>äººæ‰æœå°‹ï¼ˆSourcingï¼‰</div>
        </div>
        <div class="step-item" data-step="3">
          <div class="step-badge">3</div>
          <div>åˆæ­¥ç¯©é¸ï¼ˆScreeningï¼‰</div>
        </div>
        <div class="step-item" data-step="4">
          <div class="step-badge">4</div>
          <div>é¢è©¦éšæ®µï¼ˆInterviewï¼‰</div>
        </div>
      </div>

      <div class="sidebar-footer">
        æ‰‹æ©Ÿç‰ˆï¼šé»ä¸Šé¢çš„åŠŸèƒ½ï¼Œ<br />
        æœƒæ‰“é–‹å…¨è¢å¹•ç”Ÿæˆé ï¼ŒæŒ‰ã€Œâœ•ã€å¾Œé—œé–‰ï¼Œ<br />
        åªç•™ä¸‹ä¸‹é¢çš„ AI å°è©±æ¡†ã€‚
        <div class="pill">
          ğŸ”Œ Frontend â†’ Backend â†’ LLM
        </div>
      </div>
    </aside>

    <!-- å³å´ä¸»ç•«é¢ï¼šå·¥å…·ï¼ˆæ¡Œæ©Ÿï¼‰ï¼‹èŠå¤© -->
    <main class="card">
      <!-- å·¥å…·å€ï¼šæ¡Œæ©Ÿ=å…§åµŒï¼Œæ‰‹æ©Ÿ=å½ˆçª— -->
      <section id="tool-modal" class="tool-modal open">
        <div class="tool-inner-card">
          <div class="main-header">
            <div class="main-title-wrap">
              <div class="main-title" id="main-title">â‘  è·ç¼ºéœ€æ±‚ï¼ˆJob Intakeï¼‰</div>
              <div class="main-subtitle" id="main-subtitle">
                HR è²¼ä¸Šè·ç¼ºèªªæ˜ï¼ˆJDï¼‰ â†’ å¾Œç«¯å‘¼å« LLM ç”Ÿæˆäººæ‰ç•«åƒèˆ‡çµæ§‹åŒ–æ¬„ä½
              </div>
            </div>
            <div style="display:flex;align-items:center;gap:8px;">
              <div class="badge-ai">
                <div class="badge-dot"></div>
                LLM Agent Connected
              </div>
              <button class="tool-close-btn" id="tool-close-btn">âœ• é—œé–‰</button>
            </div>
          </div>

          <div class="panel">
            <!-- å·¦ï¼šè¼¸å…¥ -->
            <div>
              <h4>è¼¸å…¥ï¼ˆHR è²¼ä¸Šå…§å®¹ï¼‰</h4>
              <p class="hint" id="input-hint">
                ç›®å‰æ­¥é©Ÿï¼šè·ç¼ºéœ€æ±‚ï¼ˆJob Intakeï¼‰ã€‚è«‹è²¼ä¸Šå®Œæ•´ JDã€‚
              </p>
              <textarea id="input-text" spellcheck="false">è·ç¼ºï¼šçŸ­å½±éŸ³å‰ªè¼¯å¸«

æˆ‘å€‘æ˜¯ä¸€é–“å°ˆé–€åš AIã€çŸ­å½±éŸ³æ•™å­¸çš„å…¬å¸ï¼Œæ­£åœ¨æ‰¾ä¸€ä½å…¨è·çŸ­å½±éŸ³å‰ªè¼¯å¸«ï¼Œè² è²¬ TikTokã€Reelsã€YouTube Shorts çš„å‰ªè¼¯ã€‚
éœ€è¦ç†Ÿæ‚‰å‰ªæ˜ æˆ– Premiereï¼Œæœƒåšå­—å¹•ã€éŸ³æ¨‚ç¯€å¥ã€è½‰å ´ï¼Œæ‡‚ä¸€é»ç¤¾ç¾¤æ„Ÿçš„ç¯€å¥ï¼ŒçŸ¥é“ä»€éº¼ç•«é¢å®¹æ˜“å¸å¼•è§€çœ¾æ»‘åœã€‚
éœ€å…·å‚™ 1â€“3 å¹´å‰ªè¼¯ç¶“é©—ï¼Œæœ‰ä½œå“é›†ï¼Œèƒ½é…åˆ remote åœ˜éšŠæºé€šã€‚
åŠ åˆ†ï¼šæœ‰æ‹æ”ç¶“é©—ã€æ‡‚è…³æœ¬ç¯€å¥ã€æœƒåŸºæœ¬çš„ç¸®åœ–è¨­è¨ˆã€‚</textarea>

              <div class="toolbar">
                <div style="display:flex;gap:6px;flex-wrap:wrap;">
                  <button class="btn-primary" id="run-btn">
                    âš¡ é€å‡ºçµ¦å¾Œç«¯ & LLM åˆ†æ
                  </button>
                  <button class="btn-primary" id="retry-btn" disabled
                    style="background:#e5e7eb;color:#374151;box-shadow:none;">
                    ğŸ” å†æ›ä¸€å€‹
                  </button>
                  <button class="btn-primary" id="save-btn" disabled
                    style="background:#22c55e;box-shadow:none;">
                    ğŸ’¾ å„²å­˜
                  </button>
                </div>
                <div>
                  <span style="font-size:11px;color:var(--text-soft);">
                    æœƒ POST åˆ° <code>/api/hr-agent</code>ï¼Œå„²å­˜å‰‡å‘¼å« <code>/api/hr-save</code>
                  </span>
                </div>
              </div>
              <div class="status" id="status">
                <span class="dot"></span> ç­‰å¾…é€å‡ºâ€¦
              </div>
            </div>

            <!-- å³ï¼šè¼¸å‡º -->
            <div>
              <h4>AI å›å‚³çµæœï¼ˆç”±å¾Œç«¯è½‰çµ¦å‰ç«¯ï¼‰</h4>
              <p class="hint">
                é¡¯ç¤ºå¾Œç«¯å›å‚³çš„ <code>result</code> æ¬„ä½å…§å®¹ï¼ˆå­—ä¸²æˆ– JSON éƒ½å¯ï¼‰ã€‚
              </p>
              <pre id="output-pre">// é»ã€Œé€å‡ºçµ¦å¾Œç«¯ & LLM åˆ†æã€å¾Œæœƒé¡¯ç¤ºçµæœ</pre>
            </div>
          </div>

          <div class="chip-row">
            <div class="chip">æ­¥é©Ÿä»¥ <code>step</code> å‚³çµ¦å¾Œç«¯ï¼šjob_intake / sourcing / screening / interview</div>
            <div class="chip">å¾Œç«¯è² è²¬é¸ Promptã€ä¸² LLMã€æ•´ç† JSON</div>
            <div class="chip">å„²å­˜ API æœƒæ”¶åˆ°ï¼š<code>{ step, input, result }</code></div>
          </div>
        </div>
      </section>

      <!-- Chat å€å¡Šï¼šæ‰‹æ©Ÿé—œæ‰å·¥å…·å¾Œï¼Œåªå‰©é€™å€‹ç•«é¢ -->
      <div class="chat-card">
        <div class="chat-header">
          <div>
            <div class="chat-title">ğŸ’¬ è·Ÿ AI å°è©±ï¼ˆHR é¡§å•æ¨¡å¼ï¼‰</div>
            <div class="chat-subtitle">å¯ä»¥å•æ‹›å‹Ÿç­–ç•¥ã€JD èª¿æ•´å»ºè­°ã€é¢è©¦å•é¡Œè¨­è¨ˆç­‰ã€‚</div>
          </div>
        </div>

        <div class="chat-window" id="chat-window">
          <div class="chat-empty">
            é‚„æ²’æœ‰å°è©±ç´€éŒ„ï¼Œå¯ä»¥è©¦è©¦å•ï¼š<br />
            ã€Œå¹«æˆ‘å„ªåŒ–é€™å€‹å‰ªè¼¯å¸« JD çš„æ¨™é¡Œã€æˆ–ã€Œæˆ‘ç¾åœ¨é€™å€‹äººæ‰ç•«åƒåˆç†å—ï¼Ÿã€ã€‚
          </div>
        </div>

        <div class="chat-input-row">
          <input
            type="text"
            class="chat-input"
            id="chat-input"
            placeholder="è¼¸å…¥æƒ³å• AI çš„å•é¡Œï¼Œä¾‹å¦‚ï¼šå¹«æˆ‘èª¿æ•´é€™å€‹è·ç¼ºçš„äº®é»æ•˜è¿°..."
          />
          <button class="btn-chat" id="chat-send-btn">
            â¤ é€å‡º
          </button>
        </div>
        <div class="chat-status" id="chat-status">ç‹€æ…‹ï¼šå¾…æ©Ÿä¸­</div>
      </div>
    </main>
  </div>

  <script>
    // === æŠŠé€™ä¸‰å€‹æ”¹æˆä½ å¯¦éš›çš„å¾Œç«¯è·¯å¾‘ ===
    const API_URL = "/api/hr-agent";    // å››å€‹åŠŸèƒ½çš„ç”Ÿæˆç”¨
    const CHAT_API_URL = "/api/hr-chat"; // è·Ÿ AI å°è©±ç”¨
    const SAVE_API_URL = "/api/hr-save"; // å„²å­˜å±¥æ­·åˆ†æ / é¢è«‡å•é¡Œç­‰ç”¨

    const steps = document.querySelectorAll(".step-item");
    const mainTitle = document.getElementById("main-title");
    const mainSubtitle = document.getElementById("main-subtitle");
    const inputHint = document.getElementById("input-hint");
    const inputText = document.getElementById("input-text");
    const outputPre = document.getElementById("output-pre");
    const runBtn = document.getElementById("run-btn");
    const retryBtn = document.getElementById("retry-btn");
    const saveBtn = document.getElementById("save-btn");
    const statusEl = document.getElementById("status");
    const toolModal = document.getElementById("tool-modal");
    const toolCloseBtn = document.getElementById("tool-close-btn");

    // Chat å…ƒä»¶
    const chatWindow = document.getElementById("chat-window");
    const chatInput = document.getElementById("chat-input");
    const chatSendBtn = document.getElementById("chat-send-btn");
    const chatStatus = document.getElementById("chat-status");

    // å››éšæ®µè¨­å®š
    const STEP_CONFIG = {
      "1": {
        title: "â‘  è·ç¼ºéœ€æ±‚ï¼ˆJob Intakeï¼‰",
        subtitle: "HR è²¼ä¸Šè·ç¼ºèªªæ˜ï¼ˆJDï¼‰ â†’ å¾Œç«¯å‘¼å« LLM ç”Ÿæˆäººæ‰ç•«åƒèˆ‡çµæ§‹åŒ–æ¬„ä½",
        hint: "ç›®å‰æ­¥é©Ÿï¼šè·ç¼ºéœ€æ±‚ï¼ˆJob Intakeï¼‰ã€‚è«‹è²¼ä¸Šå®Œæ•´ JDã€‚",
        stepKey: "job_intake"
      },
      "2": {
        title: "â‘¡ äººæ‰æœå°‹ï¼ˆSourcingï¼‰",
        subtitle: "æ ¹æ“šè·ç¼ºè³‡è¨Šï¼Œç”¢å‡ºæ‹›å‹Ÿè²¼æ–‡ã€æœå°‹é—œéµå­—èˆ‡é‚€è«‹è¨Šæ¯",
        hint: "ç›®å‰æ­¥é©Ÿï¼šäººæ‰æœå°‹ï¼ˆSourcingï¼‰ã€‚å¯è²¼ä¸Šè·ç¼ºæ‘˜è¦ï¼Œè®“ AI å¹«ä½ ç”Ÿæ‹›å‹Ÿè²¼æ–‡èˆ‡é—œéµå­—ã€‚",
        stepKey: "sourcing"
      },
      "3": {
        title: "â‘¢ åˆæ­¥ç¯©é¸ï¼ˆScreeningï¼‰",
        subtitle: "è¼¸å…¥ JDï¼‹å±¥æ­· â†’ LLM è©•ä¼°åŒ¹é…åº¦ã€å„ªå‹¢ã€é¢¨éšªèˆ‡å»ºè­°æå•",
        hint: "ç›®å‰æ­¥é©Ÿï¼šåˆæ­¥ç¯©é¸ï¼ˆScreeningï¼‰ã€‚å»ºè­°æ ¼å¼ï¼šå…ˆè²¼ JDï¼Œå†è²¼å±¥æ­·ï¼Œä¸­é–“ç”¨ --- åˆ†éš”ã€‚",
        stepKey: "screening"
      },
      "4": {
        title: "â‘£ é¢è©¦éšæ®µï¼ˆInterviewï¼‰",
        subtitle: "è²¼ä¸Šé¢è©¦é€å­—ç¨¿ â†’ LLM ç”¢å‡ºæ‘˜è¦ã€å„ªå‹¢/ç–‘æ…®èˆ‡åˆ†æ•¸è©•ä¼°",
        hint: "ç›®å‰æ­¥é©Ÿï¼šé¢è©¦éšæ®µï¼ˆInterviewï¼‰ã€‚è«‹è²¼ä¸Šé¢è©¦é€å­—ç¨¿ï¼ˆå·²è½‰æ–‡å­—ï¼‰ã€‚",
        stepKey: "interview"
      }
    };

    let currentStep = "1";
    let lastResultPayload = null; // ç”¨ä¾†å­˜é€™æ¬¡ LLM çš„çµæœï¼Œçµ¦ã€Œå„²å­˜ã€ç”¨

    function setStatus(mode, text) {
      statusEl.className = "status " + (mode || "");
      statusEl.innerHTML = '<span class="dot"></span>' + (text || "");
    }

    function isMobile() {
      return window.innerWidth <= 900;
    }

    function openToolModal() {
      if (isMobile()) {
        toolModal.classList.add("open");
      }
    }

    function closeToolModal() {
      if (isMobile()) {
        toolModal.classList.remove("open");
      }
    }

    // åˆ‡æ›å››éšæ®µ UI
    steps.forEach((s) => {
      s.addEventListener("click", () => {
        steps.forEach((x) => x.classList.remove("active"));
        s.classList.add("active");
        const key = s.dataset.step;
        currentStep = key;

        const conf = STEP_CONFIG[key];
        mainTitle.textContent = conf.title;
        mainSubtitle.textContent = conf.subtitle;
        inputHint.textContent = conf.hint;

        outputPre.textContent =
          "// å·²åˆ‡æ›åˆ°ï¼š" +
          conf.title +
          "ã€‚\n// è²¼ä¸Šå…§å®¹å¾Œï¼Œé»ä¸‹æ–¹æŒ‰éˆ•é€å‡ºçµ¦å¾Œç«¯ & LLMã€‚";
        setStatus("", "å·²åˆ‡æ›æ­¥é©Ÿï¼Œç­‰å¾…é€å‡ºâ€¦");

        // åˆ‡æ›æ­¥é©Ÿå¾Œï¼Œæ¸…æ‰ä¸Šä¸€ç­†æš«å­˜çµæœ
        lastResultPayload = null;
        retryBtn.disabled = true;
        saveBtn.disabled = true;

        // æ‰‹æ©Ÿç‰ˆï¼šé»åŠŸèƒ½å°±æ‰“é–‹å·¥å…·å½ˆçª—
        openToolModal();
      });
    });

    // é—œé–‰å·¥å…·å½ˆçª—ï¼ˆåªå½±éŸ¿æ‰‹æ©Ÿï¼‰
    toolCloseBtn.addEventListener("click", () => {
      closeToolModal();
    });

    // å‘¼å« hr-agent çš„å…±ç”¨ function
    async function callHrAgent(isRetry = false) {
      const text = inputText.value.trim();
      if (!text) {
        setStatus("error", "è«‹å…ˆåœ¨å·¦å´è²¼ä¸Šå…§å®¹ï¼Œå†é€å‡ºçµ¦å¾Œç«¯ã€‚");
        return;
      }

      const conf = STEP_CONFIG[currentStep];

      runBtn.disabled = true;
      retryBtn.disabled = true;
      saveBtn.disabled = true;

      const actionText = isRetry ? "ï¼ˆå†æ›ä¸€å€‹ï¼‰" : "";
      setStatus(
        "loading",
        "æ­£åœ¨å‘¼å«å¾Œç«¯ APIï¼š" + API_URL + "ï¼Œstep=" + conf.stepKey + " " + actionText
      );
      outputPre.textContent = "// è«‹ç¨å€™ï¼Œå¾Œç«¯æ­£åœ¨å‘¼å« LLMâ€¦";

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            step: conf.stepKey,
            input: text,
            mode: isRetry ? "retry" : "normal"
          })
        });

        if (!res.ok) {
          throw new Error("HTTP ç‹€æ…‹ç¢¼ " + res.status);
        }

        const data = await res.json();

        let resultObject;
        let display;

        if (data == null) {
          display = "// å¾Œç«¯å›å‚³ç©ºå…§å®¹ã€‚";
          resultObject = null;
        } else if (typeof data.result === "string") {
          display = data.result;
          resultObject = data.result;
        } else if (data.result) {
          display = JSON.stringify(data.result, null, 2);
          resultObject = data.result;
        } else {
          display = JSON.stringify(data, null, 2);
          resultObject = data;
        }

        outputPre.textContent = display;
        setStatus("", "å‘¼å«æˆåŠŸï¼Œé¡¯ç¤ºå¾Œç«¯ / LLM å›å‚³çµæœã€‚");

        // â­ å­˜èµ·ä¾†çµ¦ã€Œå„²å­˜ã€ç”¨
        lastResultPayload = {
          step: conf.stepKey,
          input: text,
          result: resultObject
        };

        // é€™æ™‚å€™æ‰èƒ½å†æŒ‰ã€Œå†æ›ä¸€å€‹ã€å’Œã€Œå„²å­˜ã€
        retryBtn.disabled = false;
        saveBtn.disabled = false;
      } catch (err) {
        console.error(err);
        setStatus("error", "å‘¼å«å¾Œç«¯ API å¤±æ•—ï¼š" + err.message);
        outputPre.textContent =
          "// å‘¼å«å¾Œç«¯ API æˆ– LLM å¤±æ•—ã€‚\n" +
          "// è«‹æª¢æŸ¥ API_URL æ˜¯å¦æ­£ç¢ºã€CORS è¨­å®šï¼Œä»¥åŠå¾Œç«¯ logã€‚\n\n" +
          String(err);
      } finally {
        runBtn.disabled = false;
      }
    }

    // âš¡é€å‡º
    runBtn.addEventListener("click", () => callHrAgent(false));
    // ğŸ” å†æ›ä¸€å€‹ï¼ˆåŒæ¨£ step & input å†å«ä¸€æ¬¡ï¼‰
    retryBtn.addEventListener("click", () => callHrAgent(true));

    // ğŸ’¾ å„²å­˜ç›®å‰çµæœ
    saveBtn.addEventListener("click", async () => {
      if (!lastResultPayload) {
        setStatus("error", "ç›®å‰æ²’æœ‰å¯ä»¥å„²å­˜çš„çµæœï¼Œè«‹å…ˆè®“ AI ç”Ÿæˆä¸€æ¬¡ã€‚");
        return;
      }

      try {
        saveBtn.disabled = true;
        setStatus("loading", "æ­£åœ¨å„²å­˜é€™æ¬¡çš„çµæœåˆ°å¾Œç«¯ / DBâ€¦");

        const res = await fetch(SAVE_API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(lastResultPayload)
          // ä¹‹å¾Œä½ è¦åŠ  userId / conversationId ä¹Ÿå¯ä»¥åœ¨é€™è£¡ä¸€èµ·å‚³
        });

        if (!res.ok) {
          throw new Error("HTTP ç‹€æ…‹ç¢¼ " + res.status);
        }

        const data = await res.json();
        const id = data.id || data.savedId || "";
        setStatus("", "å·²æˆåŠŸå„²å­˜" + (id ? "ï¼ˆID: " + id + "ï¼‰" : "ã€‚"));
      } catch (err) {
        console.error(err);
        setStatus("error", "å„²å­˜å¤±æ•—ï¼š" + err.message);
      } finally {
        saveBtn.disabled = false;
      }
    });

    // === Chat åŠŸèƒ½ ===
    let chatHistory = []; // { role: 'user' | 'assistant', content: string }

    function renderChat() {
      if (!chatHistory.length) {
        chatWindow.innerHTML =
          '<div class="chat-empty">é‚„æ²’æœ‰å°è©±ç´€éŒ„ï¼Œå¯ä»¥è©¦è©¦å•ï¼š<br />ã€Œå¹«æˆ‘å„ªåŒ–é€™å€‹å‰ªè¼¯å¸« JD çš„æ¨™é¡Œã€æˆ–ã€Œæˆ‘ç¾åœ¨é€™å€‹äººæ‰ç•«åƒåˆç†å—ï¼Ÿã€ã€‚</div>';
        return;
      }

      chatWindow.innerHTML = "";
      chatHistory.forEach((msg) => {
        const row = document.createElement("div");
        row.className = "chat-msg " + (msg.role === "user" ? "me" : "ai");

        const bubble = document.createElement("div");
        bubble.className = "chat-bubble";

        const roleLabel = document.createElement("div");
        roleLabel.className = "chat-role";
        roleLabel.textContent = msg.role === "user" ? "ä½ ï¼š" : "AIï¼š";

        const content = document.createElement("div");
        content.textContent = msg.content;

        bubble.appendChild(roleLabel);
        bubble.appendChild(content);
        row.appendChild(bubble);
        chatWindow.appendChild(row);
      });

      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function setChatStatus(text) {
      chatStatus.textContent = "ç‹€æ…‹ï¼š" + text;
    }

    async function sendChat() {
      const text = chatInput.value.trim();
      if (!text) return;

      chatHistory.push({ role: "user", content: text });
      chatInput.value = "";
      renderChat();

      chatSendBtn.disabled = true;
      setChatStatus("æ­£åœ¨å‘¼å«èŠå¤© APIâ€¦");

      try {
        const res = await fetch(CHAT_API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            messages: chatHistory
          })
        });

        if (!res.ok) {
          throw new Error("HTTP ç‹€æ…‹ç¢¼ " + res.status);
        }

        const data = await res.json();
        const reply =
          data.reply || data.result || data.message || JSON.stringify(data);

        chatHistory.push({ role: "assistant", content: reply });
        renderChat();
        setChatStatus("å·²æ”¶åˆ° AI å›è¦†");
      } catch (err) {
        console.error(err);
        setChatStatus("å‘¼å«èŠå¤© API å¤±æ•—ï¼š" + err.message);
      } finally {
        chatSendBtn.disabled = false;
      }
    }

    chatSendBtn.addEventListener("click", sendChat);
    chatInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendChat();
      }
    });

    // åˆå§‹åŒ– chat ç•«é¢
    renderChat();
  </script>
</body>
</html>
